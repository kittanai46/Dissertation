<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Tracking : เอกสารการลาที่รออนุมัติ</title>
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="/image/favicon.png" type="image/png">
    <link rel="stylesheet" href="/css/Main.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Prompt', sans-serif !important;
            background-color: #fafbfe;
            margin: 0;
            padding: 0px;
        }

        h1,
        h2 {
            text-align: center;
            color: #743ae1;
            /* สีข้อความ */
        }

        table {
            width: 100%;
            table-layout: fixed;
            /* กำหนดให้ตารางมีขนาดคอลัมน์ที่เท่ากัน */
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
            word-wrap: break-word;
            /* ทำให้ข้อความตัดคำในกรณีที่ยาวเกิน */
            background-color: white !important;
            /* บังคับให้ทุกหัวตารางและคอลัมน์มีสีขาว */
        }

        th {
            background-color: white !important;
        }

        tr:nth-child(even) {
            background-color: white !important;
            /* บังคับให้ทุกแถวมีสีขาวเหมือนกัน */
        }

        tr:hover {
            background-color: white !important;
        }

        td {
            font-size: 14px;
            word-wrap: break-word;
            /* ป้องกันข้อความยาวเกินคอลัมน์ */
            background-color: white !important;
        }

        .status-approved {
            color: green !important;
            font-weight: bold;
        }

        .status-pending {
            color: orange !important;
            font-weight: bold;
        }

        .status-rejected {
            color: red !important;
            font-weight: bold;
        }

        .no-requests {
            text-align: center;
            font-style: italic;
            color: white;
        }


        .detail-btn {
            background-color: #743ae1;
            border-color: #743ae1;
            color: white;
            font-size: 0.875rem;
            padding: 0.375rem 0.75rem;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        .detail-btn:hover {
            background-color: #5b32b1;
            color: white;
            border-color: #5b32b1;
        }



        .modal-content {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            border-bottom: none;
        }

        .modal-title {
            color: #743ae1;
            font-weight: bold;
        }

        .form-control:focus {
            border-color: #743ae1;
            box-shadow: 0 0 5px rgba(116, 58, 225, 0.5);
        }

        .btn-success {
            background-color: #32b15a;
            border-color: #32b15a;
        }

        .btn-danger:hover {
            background-color: #e84118;
            border-color: #e84118;
        }


        /* จัดให้หัวตารางและสถานะอยู่ตรงกลาง */
        .table th,
        .table td {
            text-align: center;
            /* จัดข้อความให้อยู่ตรงกลางทั้งในแนวนอน */
            vertical-align: middle;
            /* จัดข้อความให้อยู่ตรงกลางในแนวตั้ง */
        }

        /* จัดให้ปุ่มอยู่ตรงกลางเซลล์ */
        .table td button {
            display: block;
            /* ทำให้ปุ่มแสดงเป็นบล็อก */
            margin: 0 auto;
            /* จัดปุ่มให้อยู่ตรงกลางในแนวนอน */
            padding: 10px 20px;
            /* เพิ่ม padding เพื่อให้ปุ่มมีขนาดใหญ่ขึ้น */
            text-align: center;
            /* จัดข้อความภายในปุ่มให้อยู่ตรงกลาง */
        }



        .modal-body p {
            text-align: left;
            /* จัดข้อความทั้งหมดให้อยู่ด้านซ้าย */
            color: #743ae1;
            /* ใช้สีม่วงสำหรับข้อความ */
            font-size: 16px;
            /* ปรับขนาดข้อความตามที่ต้องการ */
            margin-bottom: 10px;
            /* เพิ่มระยะห่างระหว่างแต่ละบรรทัด */
        }

        /* ทำให้เนื้อหาภายในป็อปอัปอยู่ด้านซ้ายทั้งหมด */
        .modal-body {
            text-align: left;
            /* จัดเนื้อหาภายในให้ชิดซ้าย */
            padding-left: 20px;
            /* เพิ่ม padding ทางซ้าย */
            padding-right: 20px;
            /* เพิ่ม padding ทางขวา */
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            /* จัดปุ่มให้อยู่ตรงกลางในแนวนอน */
            gap: 10px;
            /* เพิ่มระยะห่างระหว่างปุ่ม */
        }

        .info-grid {
            display: grid;
            grid-template-columns: 150px 10px auto;
            /* คอลัมน์แรกกว้าง 150px, คอลัมน์ที่สองแคบสำหรับ :, คอลัมน์ที่สามใช้พื้นที่ที่เหลือ */
            column-gap: 10px;
            /* ระยะห่างระหว่างคอลัมน์ */
            row-gap: 10px;
            /* ระยะห่างระหว่างแถว */
            margin-top: 20px;
        }

        .label {
            font-weight: bold;
            text-align: left;
        }

        .colon {
            text-align: center;
            /* จัดให้ : อยู่ตรงกลาง */
        }

        .value {
            text-align: left;
        }

        .documents-section {
            margin-top: 20px;
            /* เพิ่มระยะห่างระหว่างตารางข้อมูลและส่วนเอกสาร */
        }

        .documents-section p {
            margin-bottom: 15px;
            /* เพิ่มระยะห่างระหว่างพารากราฟในส่วนเอกสาร */
        }

        iframe {
            border: 1px solid #ddd;
            /* เพิ่มขอบให้ iframe เพื่อความเป็นระเบียบ */
            margin-top: 10px;
            /* เพิ่มระยะห่างระหว่างข้อความและ iframe */
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <aside id="sidebar">
            <div class="d-flex">
                <button class="toggle-btn" type="button">
                    <i class="lni lni-grid-alt"></i>
                </button>
                <div class="sidebar-logo">
                    <a href="/">TRACKING</a>
                </div>
            </div>
            <ul class="sidebar-nav">
                <li class="sidebar-item">
                    <a href="/classroom" class="sidebar-link">
                        <i class="lni lni-network"></i>
                        <span>ห้องเรียน</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="/calculate" class="sidebar-link">
                        <i class="lni lni-calculator"></i>
                        <span>คำนวณคะแนน</span>
                    </a>
                </li>                
                <li class="sidebar-item">
                    <a href="/graph" class="sidebar-link">
                        <i class="lni lni-graph"></i>
                        <span>ภาพรวมข้อมูล</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="" class="sidebar-link collapsed has-dropdown" data-bs-toggle="collapse"
                        data-bs-target="#auth" aria-expanded="false" aria-controls="auth">
                        <i class="lni lni-folder"></i>
                        <span>เอกสารการลา</span>
                    </a>
                    <ul id="auth" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
                        <li class="sidebar-item">
                            <a href="/leave-requests/<%= teacherId %>" class="sidebar-link">การลาที่รออนุมัติ</a>
                        </li>
                        <li class="sidebar-item">
                            <a href="/leave-history/<%= teacherId %>" class="sidebar-link">ประวัติการลา</a>
                        </li>
                    </ul>
                </li>
                <li class="sidebar-item">
                    <a href="/notification" class="sidebar-link">
                        <i class="lni lni-popup"></i>
                        <span>การแจ้งเตือน</span>
                    </a>
                </li>
            </ul>
            <div class="sidebar-footer">
                <a href="/logout" class="sidebar-link">
                    <i class="lni lni-exit"></i>
                    <span>ออกจากระบบ</span>
                </a>
            </div>
        </aside>
        <div class="main p-3">
            <div class="text-center">

                <h1>เอกสารการลาที่รออนุมัติ</h1>

                <!-- คำขอที่รอการอนุมัติ -->
                <h2>คำขอที่ยังรอการอนุมัติ</h2>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>รหัสนิสิต</th>
                            <th>ชื่อนิสิต</th>
                            <th>วิชา</th>
                            <th>สถานะ</th>
                            <th>รายละเอียด</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (pendingRequests.filter(request=> request.status === 'รออนุมัติ').length > 0) { %>
                            <% pendingRequests.filter(request=> request.status === 'รออนุมัติ').forEach(request => { %>
                                <tr>
                                    <td>
                                        <%= request.student_id %>
                                    </td>
                                    <td>
                                        <%= request.student_name %>
                                    </td>
                                    <td>
                                        <%= request.course_name %> <%= request.course_code %>[<%= request.section %>] 
                                    </td>
                                    <td class="status-pending">
                                        <%= request.status %>
                                    </td>
                                    <td>
                                        <button class="btn btn-primary btn-sm detail-btn" data-bs-toggle="modal"
                                            data-bs-target="#detailModal<%= request.id %>">ดูรายละเอียด</button>

                                    </td>
                                </tr>

                                <!-- ป็อปอัพแสดงข้อมูลทั้งหมด -->
                                <div class="modal fade" id="detailModal<%= request.id %>" tabindex="-1"
                                    aria-labelledby="detailModalLabel<%= request.id %>" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="detailModalLabel<%= request.id %>">
                                                    รายละเอียดคำขอลา</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="info-grid">
                                                    <div class="label"><strong>รหัสนิสิต</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <%= request.student_id %>
                                                    </div>

                                                    <div class="label"><strong>ชื่อนิสิต</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <%= request.student_name %>
                                                    </div>

                                                    <div class="label"><strong>วิชา</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <%= request.course_name %> <%= request.course_code %>[<%= request.section %>] 
                                                    </div>

                                                    <div class="label"><strong>ประเภทการลา</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <%= request.leave_type %>
                                                    </div>

                                                    <div class="label"><strong>เหตุผล</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <%= request.reason %>
                                                    </div>

                                                    <div class="label"><strong>วันที่เริ่ม</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <%= new Date(request.start_date).toLocaleDateString() %>
                                                    </div>

                                                    <div class="label"><strong>วันที่สิ้นสุด</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <%= new Date(request.end_date).toLocaleDateString() %>
                                                    </div>

                                                    <div class="label"><strong>เอกสารการลา</strong></div>
                                                    <div class="colon">:</div>
                                                    <div class="value">
                                                        <% if (request.has_leave_document) { %>
                                                            มี
                                                            <% } else { %> ไม่มี <% } %>
                                                    </div>
                                                </div>

                                                <% if (request.has_leave_document) { %>
                                                    <!-- เอกสารการลา -->
                                                    <iframe src="/view-leave-document/<%= request.id %>" width="100%"
                                                        height="500px"></iframe>
                                                    <% } %>

                                                        <div class="info-grid">
                                                            <div class="label"><strong>ใบรับรองแพทย์</strong></div>
                                                            <div class="colon">:</div>
                                                            <div class="value">
                                                                <% if (request.has_medical_certificate) { %>
                                                                    มี
                                                                    <% } else { %> ไม่มี <% } %>
                                                            </div>
                                                        </div>

                                                        <% if (request.has_medical_certificate) { %>
                                                            <!-- ใบรับรองแพทย์ -->
                                                            <iframe src="/view-medical-certificate/<%= request.id %>"
                                                                width="100%" height="500px"></iframe>
                                                            <% } %>

                                                                <!-- ฟิลด์สำหรับความคิดเห็น -->
                                                                <div class="form-group d-flex align-items-center">
                                                                    <label for="comment<%= request.id %>"
                                                                        class="me-3"><strong>ความคิดเห็น (ถ้ามี):</strong></label>
                                                                    <textarea class="form-control w-50"
                                                                        id="comment<%= request.id %>" name="comment"
                                                                        rows="3"
                                                                        placeholder="ใส่ความคิดเห็น"></textarea>
                                                                </div>

                                                                <!-- ปุ่มอนุมัติและปฏิเสธ -->
                                                                <div class="action-buttons">
                                                                    <form
                                                                        action="/web/approve-leave-request/<%= request.id %>"
                                                                        method="POST" style="display: inline;">
                                                                        <input type="hidden" name="status"
                                                                            value="อนุมัติ">
                                                                        <input type="hidden"
                                                                            id="comment-field-approve-<%= request.id %>"
                                                                            name="comment">
                                                                        <button type="submit" class="btn btn-success"
                                                                            onclick="document.getElementById('comment-field-approve-<%= request.id %>').value = document.getElementById('comment<%= request.id %>').value;">
                                                                            อนุมัติ
                                                                        </button>
                                                                    </form>

                                                                    <form
                                                                        action="/web/approve-leave-request/<%= request.id %>"
                                                                        method="POST" style="display: inline;">
                                                                        <input type="hidden" name="status"
                                                                            value="ไม่อนุมัติ">
                                                                        <input type="hidden"
                                                                            id="comment-field-reject-<%= request.id %>"
                                                                            name="comment">
                                                                        <button type="submit" class="btn btn-danger"
                                                                            onclick="document.getElementById('comment-field-reject-<%= request.id %>').value = document.getElementById('comment<%= request.id %>').value;">
                                                                            ปฏิเสธ
                                                                        </button>
                                                                    </form>
                                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <% }) %>
                                    <% } else { %>
                                        <tr>
                                            <td colspan="5" class="no-requests">ไม่มีคำขอที่รออนุมัติ</td>
                                        </tr>
                                        <% } %>
                    </tbody>
                </table>
        </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script src="/Sidebar.js"></script>
</body>
</html>
